var floodfill=(function(){function c(k,h,A,q,p,o,t){var B=q.getImageData(0,0,p,o);var z=B.data;var f=z.length;var g=[];var s=(k+h*p)*4;var u=s,m=s,v,n,l=p*4;var d=[z[s],z[s+1],z[s+2],z[s+3]];t=(!isNaN(t))?Math.min(Math.abs(t),254):0;if(!a(s,d,A,z,f,t)){return false}g.push(s);while(g.length){s=g.pop();if(b(s,d,A,z,f,t)){u=s;m=s;n=parseInt(s/l)*l;v=n+l;while(n<m&&n<(m-=4)&&b(m,d,A,z,f,t)){}while(v>u&&v>(u+=4)&&b(u,d,A,z,f,t)){}for(var r=m;r<u;r+=4){if(r-l>=0&&a(r-l,d,A,z,f,t)){g.push(r-l)}if(r+l<f&&a(r+l,d,A,z,f,t)){g.push(r+l)}}}}q.putImageData(B,0,0)}function a(f,h,e,j,g,d){if(f<0||f>=g){return false}if(j[f+3]===0&&e.a>0){return true}if((h[3]===e.a)&&(h[0]===e.r)&&(h[1]===e.g)&&(h[2]===e.b)){return false}if((h[3]===j[f+3])&&(h[0]===j[f])&&(h[1]===j[f+1])&&(h[2]===j[f+2])){return true}if(Math.abs(h[3]-j[f+3])<=(255-d)&&Math.abs(h[0]-j[f])<=d&&Math.abs(h[1]-j[f+1])<=d&&Math.abs(h[2]-j[f+2])<=d){return true}return false}function b(f,h,e,j,g,d){if(a(f,h,e,j,g,d)){j[f]=e.r;j[f+1]=e.g;j[f+2]=e.b;j[f+3]=e.a;return true}return false}return c})();